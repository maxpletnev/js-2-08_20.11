!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){},function(t,e,r){},function(t,e,r){"use strict";r.r(e);var n={el:"#app",data:{},methods:{getJSON:function(t){return fetch(t).then((function(t){return t.json()}))},postJSON:function(t,e){return fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",keepalive:!1,body:JSON.stringify(e)})},putJSON:function(t,e){return fetch(t,{method:"PUT",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",keepalive:!1,body:JSON.stringify(e)})},deleteJSON:function(t,e){return fetch(t,{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",keepalive:!1,body:JSON.stringify(e)})},showCart:function(){this.$children[0].show()}},mounted:function(){},components:{catalog:{data:function(){return{items:[],imgCatalog:"https://placehold.it/200x150",catalogUrl:"/api/catalogData"}},methods:{addProduct:function(t){this.$parent.$children[0].addProduct(t)}},mounted:function(){var t=this;this.$parent.getJSON(this.catalogUrl).catch((function(e){return t.$parent.$children[2].viewError("Ошибка загрузки товаров каталога: "+e)})).then((function(e){return t.items=e}))},template:'\n    <div class="products">\n        <catalog-item v-for="product of items" :img="imgCatalog" :el="product" :key="product.id_product"/>\n    </div>\n    ',components:{"catalog-item":{props:["img","el"],template:'\n    <div class="product-item">\n        <img :src="img" alt="Some img">\n        <div class="desc">\n            <h3>{{ el.product_name }}</h3>\n            <p>{{ el.price }} руб.</p>\n            <button class="buy-btn" @click="$parent.addProduct(el)">Купить</button>\n        </div>\n    </div>\n    '}}},cart:{data:function(){return{items:[],amount:0,countGoods:0,imgCart:"https://placehold.it/100x80",cartUrl:"/api/getCart",updateCartUrl:"/api/addCartItem",deleteCartUrl:"/api/deleteCartItem",createCartUrl:"/api/createCart",visible:!1}},methods:{show:function(){this.visible=!this.visible},addProduct:function(t){var e=this,r=+t.id_product,n=null,i=!1,o=this.items.find((function(t){return t.id_product===r}));n={product_name:t.product_name,id_product:t.id_product,price:+t.price,quantity:1},o?o.quantity++:(this.items.push(n),i=!0),console.log(n),i?(n=[n],this.$parent.postJSON(this.createCartUrl,n).catch((function(t){return e.$parent.$children[2].viewError("Ошибка сохранения корзины: "+t)})),this.updateCountersOnFront()):(this.$parent.putJSON(this.updateCartUrl,n).catch((function(t){return e.$parent.$children[2].viewError("Ошибка сохранения корзины: "+t)})),this.updateCountersOnFront())},removeProduct:function(t){var e,r=this,n=+t.id_product,i=this.items.find((function(t){return t.id_product===n}));if(e={product_name:t.product_name,id_product:t.id_product,price:+t.price,quantity:1},i.quantity--,i.quantity<1){var o=+this.items.indexOf(i);this.items.splice(o,o),0===o&&this.items.splice(0,1)}this.$parent.deleteJSON(this.deleteCartUrl,e).catch((function(t){return r.$parent.$children[2].viewError("Ошибка сохранения корзины: "+t)})),this.updateCountersOnFront()},updateCounters:function(){var t=this;this.$parent.getJSON(this.cartUrl).catch((function(e){t.$parent.$children[2].viewError("Ошибка загрузки расчёта корзины: "+e),t.updateCountersOnFront()})).then((function(e){t.amount=e.amount,t.countGoods=e.countGoods}))},updateCountersOnFront:function(){this.amount=0,this.countGoods=0;var t=!0,e=!1,r=void 0;try{for(var n,i=this.items[Symbol.iterator]();!(t=(n=i.next()).done);t=!0)el=n.value,this.amount+=el.price*el.quantity,this.countGoods+=el.quantity}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},mounted:function(){var t=this;this.$parent.getJSON(this.cartUrl).catch((function(e){return t.$parent.$children[2].viewError("Ошибка загрузки корзины: "+e)})).then((function(e){t.items=e.contents,t.amount=e.amount,t.countGoods=e.countGoods}))},template:'\n    <div class="cart-block" v-show="visible">\n        <cart-item v-for="product of items" :img="imgCart" :el="product" :key="product.id_product"/>\n        <p>Всего товаров: {{this.countGoods}} шт.</p>\n        <p>На сумму: {{this.amount}} рублей</p>\n    </div>\n    ',components:{"cart-item":{props:["img","el"],template:'\n    <div class="cart-item" v-if="el.quantity>0">\n                    <div class="product-bio">\n                        <img :src="img" alt="Some image">\n                        <div class="product-desc">\n                            <p class="product-title">{{ el.product_name }}</p>\n                            <p class="product-quantity">Кол-во: {{ el.quantity }}</p>\n                            <p class="product-single-price">{{el.price}} руб. за единицу</p>\n                        </div>\n                    </div>\n                    <div class="right-block">\n                        <p class="product-price">{{el.quantity*el.price}}</p>\n                        <button class="del-btn" @click="$parent.removeProduct(el)">&times;</button>\n                    </div>\n                </div>\n                '}}},error:{data:function(){return{error:"",show:!1}},methods:{viewError:function(t){this.error=t,this.show=!0}},template:' \n    <div v-show="this.show"> \n                    <span>{{this.error}}</span>\n                </div>\n                '}}};r(0),r(1),new Vue(n)}]);