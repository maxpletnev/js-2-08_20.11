!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e){t.exports=require("fs")},function(t,e,n){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=n(0),s=function t(e,n,r,o){i(this,t),this.id_product=e,this.product_name=n,this.price=r,this.quantity=o},a=function(){function t(){i(this,t),this.amount=0,this.countGoods=0,this.contents=[]}var e,n,o;return e=t,(n=[{key:"updateCart",value:function(t){this.contents=t,this.amount=0,this.countGoods=0;for(var e=0;e<t.length;e++)this.amount+=t[e].price*t[e].quantity,this.countGoods+=t[e].quantity}}])&&r(e.prototype,n),o&&r(e,o),t}();function u(t,e){var n=0,r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done);r=!0)item=a.value,item.id_product==t.id_product&&n++}catch(t){i=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}if(0==n){var c=new s(t.id_product,t.product_name,t.price,t.quantity);e.push(c)}item.id_product==t.id_product&&(item.quantity+=t.quantity)}function c(t,e){for(var n=0;n<e.length;n++)e[n].id_product==t.id_product&&(e[n].quantity-=t.quantity,e[n].quantity<1&&(e.splice(n,n),0===n&&e.splice(0,1)))}t.exports={createAggregate:function(){new Promise((function(t,e){o.readFile("dist/server/db/events/events.json","utf-8",(function(e,n){if(e)console.log("EventHandler can not read events");else{for(var r=JSON.parse(n),i=new a,o=0;o<r.length;o++)switch(r[o].action){case"POST":var s=!0,f=!1,d=void 0;try{for(var l,g=r[o].event[Symbol.iterator]();!(s=(l=g.next()).done);s=!0)item=l.value,i.contents.push(item)}catch(e){f=!0,d=e}finally{try{s||null==g.return||g.return()}finally{if(f)throw d}}break;case"PUT":u(r[o].event,i.contents);break;case"DELETE":c(r[o].event,i.contents)}i.updateCart(i.contents),t(i)}}))})).then((function(t){o.writeFileSync("dist/server/db/aggregates/userCart.json",JSON.stringify(t))}))}}},function(t,e,n){"use strict";var r=n(3),i=(n(4),n(0)),o=n(5),s=r();s.use(r.static("dist/public")),s.use(r.json()),s.use(r.urlencoded({extended:!0}));var a=s.listen(80,(function(){var t=a.address().address,e=a.address().port;console.log("Application are listening at http://%s:%s",t,e)}));s.get("/api/catalogData",(function(t,e){i.readFile("dist/server/db/aggregates/catalogData.json","utf-8",(function(t,n){t?e.sendStatus(404,JSON.stringify({result:0})):e.send(n).end}))})),s.get("/api/getBasket",(function(t,e){i.readFile("dist/server/db/aggregates/userCart.json","utf-8",(function(t,n){t?e.sendStatus(404,JSON.stringify({result:0})).end:e.send(n).end}))})),s.get("/api/getCart",(function(t,e){o.get(t,e)})),s.get("/api/getHystory",(function(t,e){o.getHystory(t,e)})),s.post("/api/createCart",(function(t,e){o.createEvent(t.body,e,"POST")})),s.put("/api/addCartItem",(function(t,e){o.createEvent(t.body,e,"PUT")})),s.delete("/api/deleteCartItem",(function(t,e){o.createEvent(t.body,e,"DELETE")})),o.aggregate()},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("body-parser")},function(t,e,n){var r=n(6),i=n(7),o=n(1);t.exports={get:function(t,e){i.get(t,e)},getHystory:function(t,e){i.getHystory(t,e)},aggregate:function(){o.createAggregate()},createEvent:function(t,e,n){r.createEvent(t,e,n)}}},function(t,e,n){var r=n(0),i=n(1),o=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.action=e,this.event=n};t.exports={createEvent:function(t,e,n){return new Promise((function(e,r){e(new o(n,t))})).then((function(t){r.readFile("dist/server/db/events/events.json","utf-8",(function(n,i){if(n)console.log("ComandHandler can not read existing events"),e.sendStatus(404,JSON.stringify({result:0}));else{var o=JSON.parse(i);o.push(t),r.writeFileSync("dist/server/db/events/events.json",JSON.stringify(o))}}))})).then((function(){setTimeout((function(){return i.createAggregate()}),1e3);//!костыли из-за отсутствия реальнйо ДБ
})).then((function(){return e.sendStatus(200,JSON.stringify({result:1}))}))}}},function(t,e,n){var r=n(0);t.exports={get:function(t,e){r.readFile("dist/server/db/aggregates/userCart.json","utf-8",(function(t,n){t?e.sendStatus(404,JSON.stringify({result:0})).end:e.send(n).end}))},getHystory:function(t,e){r.readFile("dist/server/db/events/events.json","utf-8",(function(t,n){t?e.sendStatus(404,JSON.stringify({result:0})).end:e.send(n).end}))}}}]);